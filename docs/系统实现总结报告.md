# 系统实现总结报告

《教务管理系统》

19373330-赵子斌；19373332-李真哲；19373286-易嘉伟

## 1. 实现环境

### 1.1 系统框架配置

我们采取前后端分离式的开发结构，前端采用vue框架，后端采用django框架。

#### 前端

前端采用VUE框架，并借助vue的相关插件实现数据绑定，路由配置，项目编译打包等一系列工作的技术框架。并借助vue-cli，即vue脚手架实现初步的项目搭建。同时通过学习html，css，js等前端基础知识，完善整个项目。在脚手架中通过vue-router实现路由管理，通过vuex实现数据共享，通过axios实现项目的前后对接。同时vue框架具有简单易学，可构造解耦的可复用的组件来实现。

#### 后端

后端采用Django框架进行开发，其是一个免费开源的Web框架，可以用于快速的搭建高性能的网站，并且Django提供了大量网站后台开发所需要的模块，使得开发者可以专注于业务部分，这说明了其高度的完整性。同时其也具有极好的扩展性，可以支持几乎所有主流的操作系统平台，如windows、linux、macos等。最后Django是由python语言开发了，python语言的流行性就注定了，Django的使用的广泛性，这也是我们选择其作为后端开发框架的主要原因。

### 1.2 系统运行环境

#### 硬件运行环境

	内存：2GB以上
	
	硬盘容量：40GB以上
	
	外设：鼠标、键盘
	
	网络设备：宽带或无线网络

#### 软件运行环境

	操作系统：Windows 7及以上，或其他支持使用wedkit内核浏览器的操作系统
	
	连接的后端数据库：Sql Server v18.10
	
	项目运行环境：Python 3.8
	
	浏览器：使用webkit内核的浏览器，如Edge，Chrome

#### 软件测试环境

	操作系统：Windows 10
	
	连接的后端数据库：Sql Server v18.10
	
	项目运行环境：Python 3.9

  浏览器：使用webkit内核的浏览器，如Edge，Chrome

#### 硬件测试环境

   	处理器：Intel(R) Core(TM) i5-9300H CPU @ 2.40GHz   2.40 GHz
   	
   	内存：16GB
   	
   	硬盘容量：1TB（952GB可用）
   	
   	输入输出设备：鼠标、键盘、显示屏
   	
   	网络设备：WIFI

## 2. 系统功能结构图

### 2.1 用户权限及功能设计

#### 学生

* 注册账号、登录账号、注销账号、修改密码等账号系统操作
* 查询指定学院所开课程信息（包括课程学分，开课老师等）
* 查询不同种类（专业课程、基础课程等）课程的课程信息
* 查询推荐课表
* 选课、退选课程
* 查询自己已选课程的课表
* 申请免修/免听课程
* 对任课教师以及课程进行评价
* 查询不同时间段空教室信息
* 申请缓考、补考

#### 教师

* 注册账号、登录账号、注销账号、修改密码等账号系统操作
* 开设课程
* 查询自己已开课程以及当前教学任务
* 查询已选自己开设课程学生
* 申请修改自己开设课程的信息（课程名称、教室、参考书）
* 申请开设期中期末考试
* 期中、期末以及总成绩录入及申请修改
* 申请其他老师临时代课
* 申请临时调整上课时间、地点
* 查询不同时间段空教室信息
* 回复学生缓考、补考申请，并做出拒绝或允许的操作，并给出理由反馈

#### 管理员

* 注册账号、登录账号、注销账号、修改密码等账号系统操作
* 管理学生和老师的账号
* 修改任意人员的的权限或数据
* 回复老师的申请，并做出拒绝或允许的操作，并给出理由反馈

### 2.2 接口文档中实现的功能

参见docs目录下：接口文档.md

## 3. 基本表的定义，主外码等完整性约束定义，索引的定义

### 3.1 数据库表设计

#### 学生表

| 字段名   | 字段类型 | 长度 | 主\外键 | 字段值约束 |
| :------- | :------- | :--- | :------ | :--------- |
| 学号     | nvarchar | 15   | P       | Not null   |
| 姓名     | nvarchar | 5    |         | Not null   |
| 院号     | int      |      | F       | Not null   |
| 班号     | nvarchar | 5    | F       | Not null   |
| 入学年份 | nvarchar | 5    |         | Not null   |
| 年龄     | int      |      |         | Not null   |
| 籍贯     | nvarchar | 15   |         | Not null   |

原学生表是一个2NF，学号->系号，院号->系号，学号->系号 构成了非主属性对码的传递依赖。

规范操作为将系号从学生表中去掉，由院表储存相关信息。

#### 教师表

| 字段名   | 字段类型 | 长度 | 主\外键 | 字段值约束 |
| :------- | :------- | :--- | :------ | :--------- |
| 教工号   | nvarchar | 15   | P       | Not null   |
| 姓名     | nvarchar | 5    |         | Not null   |
| 院号     | int      |      | F       | Not null   |
| 年龄     | int      |      |         | Not null   |
| 邮箱     | nvarchar | 30   |         |            |
| 联系电话 | nvarchar | 11   |         |            |

教师表已经是3NF。

#### 职工表

| 字段名 | 字段类型 | 长度 | 主\外键 | 字段值约束 |
| :----- | :------- | :--- | :------ | :--------- |
| 教工号 | nvarchar | 15   | P       | Not null   |
| 姓名   | nvarchar | 5    |         | Not null   |

职工表已经是3NF。

#### 系表

| 字段名 | 字段类型 | 长度 | 主\外键 | 字段值约束 |
| :----- | :------- | :--- | :------ | :--------- |
| 系号   | int      |      | P       | Not null   |
| 系名   | nvarchar | 10   |         | Not null   |

系表已经是3NF。

#### 学院表

| 字段名 | 字段类型 | 长度 | 主\外键 | 字段值约束 |
| :----- | :------- | :--- | :------ | :--------- |
| 院号   | int      |      | P       | Not null   |
| 系号   | int      |      | F       |            |
| 院名   | nvarchar | 10   |         | Not null   |

学院表已经是3NF。

#### 班级表

| 字段名   | 字段类型 | 长度 | 主\外键 | 字段值约束 |
| :------- | :------- | :--- | :------ | :--------- |
| 班号     | nvarchar | 10   | P       | Not null   |
| 班级描述 | nvarchar | 10   |         |            |

班级表已经是3NF。

#### 课程表

| 字段名     | 字段类型     | 长度 | 主\外键 | 字段值约束 |
| :--------- | :----------- | :--- | :------ | :--------- |
| 课程码     | nvarchar     | 15   | P       | Not null   |
| 课程名称   | nvarchar     | 10   |         | Not null   |
| 前置课程码 | nvarchar     | 15   | F       |            |
| 课程类别   | nvarchar     | 10   |         | Not null   |
| 课程性质   | nvarchar     | 10   |         | Not null   |
| 学分       | unmeric(3,1) |      |         | Not null   |

课程表已经是3NF。

#### 学生选课表SC

| 字段名 | 字段类型 | 长度 | 主\外键 | 字段值约束 |
| :----- | :------- | :--- | :------ | :--------- |
| 学号   | nvarchar | 15   | P       | Not null   |
| 课程码 | nvarchar | 15   | P\F     | Not null   |

学生选课表已经是3NF。

#### 课程选课表

| 字段名   | 字段类型 | 长度 | 主\外键 | 字段值约束 |
| :------- | :------- | :--- | :------ | :--------- |
| 课程码   | nvarchar | 15   | P\F     | Not null   |
| 教室     | nvarchar | 10   |         | Not null   |
| 时间     | nvarchar | 20   |         | Not null   |
| 容量     | int      | 10   |         | Not null   |
| 已选人数 | int      |      |         | Not null   |

课程选课表已经是3NF。

#### 教师授课表

| 字段名 | 字段类型 | 长度 | 主\外键 | 字段值约束 |
| :----- | :------- | :--- | :------ | :--------- |
| 教工号 | nvarchar | 15   | P\F     | Not null   |
| 课程码 | nvarchar | 15   | F       | Not null   |

教师授课表已经是3NF。

#### 考试表

| 字段名           | 字段类型 | 长度 | 主\外键 | 字段值约束 |
| :--------------- | :------- | :--- | :------ | :--------- |
| 课程码           | nvarchar | 15   | P\F     | Not null   |
| 时间             | nvarchar | 20   |         | Not null   |
| 教室             | nvarchar | 10   |         | Not null   |
| 教工号(监考老师) | nvarchar | 15   | F       | Not null   |

考试表已经是3NF。

#### 成绩表

| 字段名   | 字段类型     | 长度 | 主\外键 | 字段值约束 |
| :------- | :----------- | :--- | :------ | :--------- |
| 学号     | nvarchar     | 15   | P\F     | Not null   |
| 课程码   | nvarchar     | 15   | P\F     | Not null   |
| 期中成绩 | numeric(5,2) |      |         |            |
| 期末成绩 | numeric(5,2) |      |         | Not null   |

成绩表已经是3NF。

#### 宿舍表

| 字段名 | 字段类型 | 长度 | 主\外键 | 字段值约束 |
| :----- | :------- | :--- | :------ | :--------- |
| 学号   | nvarchar | 15   | P\F     | Not null   |
| 姓名   | nvarchar | 5    |         | Not null   |
| 寝室号 | nvarchar | 10   |         | Not null   |

宿舍表已经是3NF。

#### 用户表

| 字段名   | 字段类型 | 长度 | 主\外键 | 字段值约束 |
| :------- | :------- | :--- | :------ | :--------- |
| 账号     | nvarchar | 20   | P       | Not null   |
| 密码     | nvarchar | 20   |         | Not null   |
| 权限类型 | nvarchar | 10   |         | Not null   |

用户表已经是3NF。

### 3.2 数据库表实现

相较于设计时的表属性与结构有所更新，核心model均位于attrs/models.py文件中，实现的数据库表如下：

#### 用户表

借用了Django的auth用户认证系统

| 字段名   | 字段类型 | 长度 | 主\外键 | 字段值约束 |
| :------- | :------- | :--- | :------ | :--------- |
| username | nvarchar | 20   | P       | Not null   |
| password | nvarchar | 20   |         | Not null   |

#### 账户表

指model-Account

| 字段名    | 字段类型 | 长度 | 主\外键 | 字段值约束 |
| :-------- | :------- | :--- | :------ | :--------- |
| 用户      | User     |      |         | Not null   |
| 账户类型  | TYPE     | 20   |         | Not null   |
| 学号/工号 | char     |      |         |            |
| 姓名      | char     |      |         |            |

#### 学生表

| 字段名   | 字段类型 | 长度 | 主\外键 | 字段值约束 |
| :------- | :------- | :--- | :------ | :--------- |
| 学号     | nvarchar | 15   | P       | Not null   |
| 姓名     | nvarchar | 5    |         | Not null   |
| 院号     | int      |      | F       | Not null   |
| 班号     | nvarchar | 5    | F       | Not null   |
| 入学年份 | nvarchar | 5    |         | Not null   |
| 年龄     | int      |      |         | Not null   |
| 籍贯     | nvarchar | 15   |         | Not null   |

原学生表是一个2NF，学号->系号，院号->系号，学号->系号 构成了非主属性对码的传递依赖。

规范操作为将系号从学生表中去掉，由院表储存相关信息。

#### 教师表

| 字段名   | 字段类型 | 长度 | 主\外键 | 字段值约束 |
| :------- | :------- | :--- | :------ | :--------- |
| 教工号   | nvarchar | 15   | P       | Not null   |
| 姓名     | nvarchar | 5    |         | Not null   |
| 院号     | int      |      | F       | Not null   |
| 年龄     | int      |      |         | Not null   |
| 邮箱     | nvarchar | 30   |         |            |
| 联系电话 | nvarchar | 11   |         |            |

教师表已经是3NF。

#### 院系表

| 字段名 | 字段类型 | 长度 | 主\外键 | 字段值约束 |
| :----- | :------- | :--- | :------ | :--------- |
| 院系号 | int      |      | P       | Not null   |
| 院名   | nvarchar | 10   |         | Not null   |
| 系主任 | char     |      |         |            |

学院表已经是3NF。

#### 班级表

| 字段名   | 字段类型 | 长度 | 主\外键 | 字段值约束 |
| :------- | :------- | :--- | :------ | :--------- |
| 班号     | nvarchar | 10   | P       | Not null   |
| 班级描述 | nvarchar | 10   |         |            |

班级表已经是3NF。

#### 课程表

| 字段名   | 字段类型   | 长度 | 主\外键 | 字段值约束 |
| :------- | :--------- | :--- | :------ | :--------- |
| 课程码   | nvarchar   | 15   | P       | Not null   |
| 课程名称 | nvarchar   | 10   |         | Not null   |
| 先修课   | nvarchar   | 15   | F       |            |
| 课程类别 | nvarchar   | 10   |         | Not null   |
| 学分     | Integer    |      |         | Not null   |
| 课程时间 | CourseTime |      | F       | Not null   |
| 课程地点 | Place      |      | F       |            |
| 课程学年 | Integer    |      |         | Not null   |
| 开课学院 | Department |      | F       | Not null   |
| 总容量   | Integer    |      |         | Not null   |
| 当前人数 | Integer    |      |         | Not null   |

#### 开课表

| 字段名 | 字段类型 | 长度 | 主\外键 | 字段值约束 |
| :----- | :------- | :--- | :------ | :--------- |
| 教工号 | nvarchar | 15   | P\F     | Not null   |
| 课程码 | nvarchar | 15   | F       | Not null   |

#### 选课表SC

| 字段名   | 字段类型 | 长度 | 主\外键 | 字段值约束 |
| :------- | :------- | :--- | :------ | :--------- |
| 学号     | nvarchar | 15   |         | Not null   |
| 课程码   | nvarchar | 15   | F       | Not null   |
| 成绩     | int      |      |         | Not null   |
| 评教     | int      |      |         | Not null   |
| 是否评教 | boolean  | 10   |         | Not null   |

课程选课表已经是3NF。

#### 考试表

| 字段名           | 字段类型 | 长度 | 主\外键 | 字段值约束 |
| :--------------- | :------- | :--- | :------ | :--------- |
| 课程码           | nvarchar | 15   | P\F     | Not null   |
| 时间             | nvarchar | 20   |         | Not null   |
| 考试地点         | Place    | 10   | F       | Not null   |
| 教工号(监考老师) | nvarchar | 15   | F       | Not null   |

考试表已经是3NF。

## 4. 系统的安全性设计，不同人员的外模式及相关权限

### 4.1 安全性防护

#### Django安全性防护

本部分内容为利用Django中的中间模块MIddleWare完成配置与防护，相关设置代码如下：

```python
MIDDLEWARE = [
    'django.middleware.security.SecurityMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    #
    'corsheaders.middleware.CorsMiddleware',
    #
    'django.middleware.common.CommonMiddleware',
    #'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
    'django.contrib.redirects.middleware.RedirectFallbackMiddleware'
]
```

但在本地调试时，为保证正常与数据交互，关闭了跨站点请求伪造（CSRF）服务，但其余防护功能仍生效，相关防护如下（部分内容取自Django文档）：

##### 防御跨站脚本攻击（XSS）

Django 模板可以保护您免受大多数 XSS 攻击。但是了解它提供了怎样的保护，以及有什么限制是很重要的。

对于 HTML 来说，Django 模板中的 转义特殊字符 是尤其危险的。虽然它保护用户免受大多数恶意输入的攻击，但并非万无一失。

##### 防御跨站点请求伪造（CSRF）

Django 内置了保护措施来防御大多数 CSRF 攻击，您需要在合适的地方授权并使用它 。但和多数缓解性技术一样，它是有局限性的。比如可以全局禁用 CSRF 模块或者特定的视图。请三思而后行。如果您的网页还有脱离您控制的子域，还将会有其他 限制 。

CSRF 保护机制 通过检查每一个 POST 请求中的密文来实现。这保证恶意用户不能“复现”一个表单并用 POST 提交到你的网页，并让一个已登录用户无意中提交该表单。恶意用户必须知道特定于用户的密文（使用 cookie）。

在部署 HTTPS 时，CsrfViewMiddleware 会检查 HTTP 报文的 referer 首部是否设置为同源的 URL（包括子域和端口）。因为 HTTPS 提供了额外的安全性，所有通过转发不安全连接请求并在支持的浏览器中使用 HSTS 来确保连接在可用的地方使用了 HTTPS ，这一点是很重要的。

##### 防御 SQL 注入

SQL 注入能让恶意用户能在数据库中执行任意 SQL 代码。这将导致记录被删除或泄露。

Django 的 querysets 在被参数化查询构建出来时就被保护而免于 SQL 注入。查询的 SQL 代码与查询的参数是分开定义的。参数可能来自用户从而不安全，因此它们由底层数据库引擎进行转义。

Django 也为开发者提供了书写 原始查询 或执行 自定义 sql 的权力。应当尽可能少地使用这些方法，并且您应该小心并准确地转义一切用户可控的参数。另外，在使用 extra() 和 RawSQL 时应当小心谨慎。

##### 防御访问劫持

访问劫持能让恶意网页覆盖另一个网页。可能会有毫不知情的用户被骗入目标网页并执行意料之外的操作。

Django 包含 访问劫持保护 ，以 X-Frame-Options middleware 的形式在支持它的浏览器中阻止一个网页被渲染在 frame 的内部。可在每个视图的基础上禁用保护，也可配置发送的确切头部值。

##### SSL/HTTPS

通过 HTTPS 部署您的网页是保障安全的最佳办法。没有它，恶意用户就可以在客户端和服务器之间嗅探验证资格或其他信息，在某些情况下 -- 比如 主动 网络攻击者 -- 会修改发送中的数据。

##### Host 头部验证

在某些情况下，Django 使用客户端提供的 Host 头部来构造 URLs。这些值虽被清理以阻止跨站脚本攻击，但伪造 Host 值还是可以用于跨站请求伪造，缓存毒化攻击，以及电子邮件中的有毒链接。

#### 系统自定义防护

除了Django保障的基础防护机制外，通过教务系统的用户登录、验证机制保障了系统数据安全性

##### 登陆验证

借助了Django验证系统：即 django.contrib.auth 的 Django contrib 模块。默认情况下，所需的配置以及包含在 django-admin startproject 生成的 settings.py 中，在 INSTALLED_APPS 配置列出了以下两个条目：

1. 'django.contrib.auth' 包含了验证框架的内核和它的默认模型。
2. 'django.contrib.contenttypes' 是 Django content type system ，允许创建的模型和权限相关联。

这些条目在对应的 MIDDLEWARE 设置中：

1. SessionMiddleware 通过请求管理 sessions 。
2. AuthenticationMiddleware 使用会话将用户和请求关联。

### 4.2 外模式

### 4.3 权限管理

## 5. 存储过程、触发器和函数的代码说明

### 5.1 前端说明

### 5.2 后端说明

函数在

## 6. 实现过程中主要技术和主要模块的论述

### 6.1 前端说明



### 6.2 后端说明

主要在django提供的模块基础上完成开发

#### url跳转

#### 登陆验证

#### 数据库操作

#### 第三方库

## 7. 若干展示系统功能的运行实例

略

## 8. 源程序简要说明

### 8.1 前端说明



### 8.2 后端说明

#### 数据文件

docs文件夹中包含了系统设计、实现报告等内容，此外，自编的数据也存入其中，包括：

* user.xlsx：登录用户账号及密码；
* basedata.xlsx：系统中的学生、教师、学院、课程、班级、选课、考试、成绩、上课时间、地点等等全部数据库表的已有数据
* Django管理员密码.txt：登录djangosuperadmin后台的账号密码
* reference.txt：参考的资料链接
* 交互接口.md：前后端的交互接口

#### apps

最主要的app为attrs，在文件夹EMSDB/apps/attrs下，主要包含了模型model、url链接、views视图函数等内容

#### 数据库

文件EMSDB/db.sqlite3为使用的数据库

每个apps中的migration存储了数据迁移记录

#### 基本设置

基本设置位于EMSDB/EMSDB/settings.py中

url链接跳转管理在EMSDB/EMSDB/urls.py中

## 9. 收获和体会

收获颇丰